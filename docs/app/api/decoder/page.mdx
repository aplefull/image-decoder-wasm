# imageDecoder

The main API for decoding images. The library exports a singleton instance `imageDecoder` for immediate use.

## Import

```javascript
import imageDecoder from 'image-decoder-wasm';

import { imageDecoder } from 'image-decoder-wasm';
```

Both default and named imports are available.

## Methods

### decode()

```typescript
async decode(buffer: ArrayBuffer): Promise<ImageData>
```

Decodes an image buffer into ImageData. Automatically detects the format and uses the appropriate decoder.

#### Parameters

- `buffer` (ArrayBuffer): The image data to decode

#### Returns

Promise that resolves to a standard [ImageData](https://developer.mozilla.org/en-US/docs/Web/API/ImageData) object containing:
- `width`: Image width in pixels
- `height`: Image height in pixels
- `data`: Uint8ClampedArray of RGBA pixel data

#### Throws

- Error if no decoder is found for the format
- Error if decoding fails

#### Example

```javascript
import imageDecoder from 'image-decoder-wasm';

const response = await fetch('image.avif');
const buffer = await response.arrayBuffer();

const imageData = await imageDecoder.decode(buffer);
```

### decodeToImage()

```typescript
async decodeToImage(buffer: ArrayBuffer): Promise<HTMLImageElement>
```

Decodes an image buffer and returns an HTMLImageElement. This is convenient when you need a ready-to-use image element for display in the DOM.

#### Parameters

- `buffer` (ArrayBuffer): The image data to decode

#### Returns

Promise that resolves to an [HTMLImageElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement) that can be directly added to the DOM.

#### Throws

- Error if no decoder is found for the format
- Error if decoding fails
- Error if canvas context cannot be created
- Error if image element creation fails

#### Example

```javascript
import imageDecoder from 'image-decoder-wasm';

const response = await fetch('image.avif');
const buffer = await response.arrayBuffer();

const img = await imageDecoder.decodeToImage(buffer);
document.body.appendChild(img);
```

### getSupportedFormats()

```typescript
getSupportedFormats(): string[]
```

Returns an array of all supported image formats.

#### Returns

Array of format strings (lowercase).

#### Example

```javascript
import imageDecoder from 'image-decoder-wasm';

const formats = imageDecoder.getSupportedFormats();
console.log(formats);
```

## ImageData Object

The `decode()` method returns a standard ImageData object:

```typescript
interface ImageData {
  readonly width: number;
  readonly height: number;
  readonly data: Uint8ClampedArray;
  readonly colorSpace: PredefinedColorSpace;
}
```

### Properties

- `width`: Image width in pixels
- `height`: Image height in pixels
- `data`: Pixel data in RGBA format (4 bytes per pixel)
- `colorSpace`: Color space (typically `'srgb'`)

### Data Layout

The `data` property contains pixels in RGBA format:

```
[R, G, B, A, R, G, B, A, R, G, B, A, ...]
```

Where:
- R = Red (0-255)
- G = Green (0-255)
- B = Blue (0-255)
- A = Alpha (0-255, 255 = fully opaque)

To access a specific pixel:

```javascript
function getPixel(imageData, x, y) {
  const index = (y * imageData.width + x) * 4;
  return {
    r: imageData.data[index],
    g: imageData.data[index + 1],
    b: imageData.data[index + 2],
    a: imageData.data[index + 3],
  };
}
```